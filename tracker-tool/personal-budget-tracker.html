<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Budget Tracker - Calculator.toolblaster</title>
    <meta name="description" content="A simple and effective personal budget tracker to monitor your income and expenses. Take control of your finances and reach your goals.">
    <meta name="keywords" content="tracker, personal finance, budget tracker, money management, expense tracker, income tracker, financial planner">
    
    <!-- Google Font: Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js for the Doughnut Chart -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Main site stylesheet for overall layout -->
    <link rel="stylesheet" href="../assets/css/style.css">

    <style>
        .tracker-wrapper {
            max-width: 800px;
            margin: 2rem auto;
        }
        .summary-card-container > div {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: all 0.2s ease-in-out;
            cursor: pointer;
        }
        .summary-card-container > div:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .transaction-form-grid {
            grid-template-columns: 1fr 1fr 120px;
        }
        .transaction-list-item {
            animation: fadeIn 0.5s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @media (max-width: 640px) {
            .transaction-form-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body class="bg-gray-50 flex flex-col min-h-screen">

    <div id="header-placeholder"></div>

    <main class="flex-grow p-4 sm:p-6 lg:p-8">
        <div class="tracker-wrapper w-full bg-white rounded-2xl shadow-xl p-6 sm:p-8">
            <h1 class="text-3xl font-bold text-gray-800 text-center mb-1">Personal Budget Tracker</h1>
            <p class="text-sm text-gray-500 text-center mb-8">Take control of your finances by tracking every rupee.</p>
            
            <!-- Summary Section -->
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-8 summary-card-container">
                <div class="bg-green-50 rounded-xl p-4 text-center border border-green-200">
                    <h3 class="text-sm font-medium text-green-700">Total Income</h3>
                    <p id="total-income" class="text-2xl font-bold text-green-800 mt-1">₹0</p>
                </div>
                <div class="bg-red-50 rounded-xl p-4 text-center border border-red-200">
                    <h3 class="text-sm font-medium text-red-700">Total Expenses</h3>
                    <p id="total-expenses" class="text-2xl font-bold text-red-800 mt-1">₹0</p>
                </div>
                <div class="bg-blue-50 rounded-xl p-4 text-center border border-blue-200">
                    <h3 class="text-sm font-medium text-blue-700">Net Balance</h3>
                    <p id="net-balance" class="text-2xl font-bold text-blue-800 mt-1">₹0</p>
                </div>
            </div>

            <!-- Chart Section -->
            <div class="mb-8 p-4 bg-gray-50 rounded-xl border border-gray-200">
                <h3 class="text-lg font-semibold text-gray-700 text-center mb-4">Income vs Expenses</h3>
                <div class="h-48">
                    <canvas id="budget-chart"></canvas>
                </div>
            </div>

            <!-- Transaction Form -->
            <form id="transaction-form" class="bg-gray-100 p-6 rounded-xl space-y-4 shadow-inner">
                <h3 class="text-lg font-semibold text-gray-700 mb-4">Add New Transaction</h3>
                <div class="grid sm:grid-cols-3 gap-4 transaction-form-grid">
                    <input type="text" id="transaction-text" class="w-full p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="Description (e.g., Groceries, Salary)" required>
                    <input type="number" id="transaction-amount" class="w-full p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="Amount (₹)" required>
                    <select id="transaction-type" class="w-full p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-red-500 appearance-none bg-white">
                        <option value="expense">Expense</option>
                        <option value="income">Income</option>
                    </select>
                </div>
                <button type="submit" class="w-full bg-red-600 text-white font-semibold py-3 px-6 rounded-lg transition-colors hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500">
                    Add Transaction
                </button>
            </form>
            
            <!-- Transaction History -->
            <div class="mt-8">
                <h3 class="text-lg font-semibold text-gray-700 text-center mb-4">Transaction History</h3>
                <ul id="transaction-list" class="bg-gray-100 rounded-xl divide-y divide-gray-200 overflow-hidden shadow-inner">
                    <!-- Transactions will be dynamically added here -->
                </ul>
                <p id="no-transactions-message" class="text-center text-gray-500 mt-4 text-sm hidden">No transactions yet. Add one to get started!</p>
            </div>
            
        </div>
    </main>

    <div id="footer-placeholder"></div>

    <!-- Notification Toast -->
    <div id="notification-toast" class="fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-6 py-3 rounded-full text-sm shadow-lg opacity-0 transition-opacity duration-300 pointer-events-none"></div>

    <!-- Main site scripts and tracker specific script -->
    <script src="../script.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const getElem = id => document.getElementById(id);
            const form = getElem('transaction-form');
            const textInput = getElem('transaction-text');
            const amountInput = getElem('transaction-amount');
            const typeSelect = getElem('transaction-type');
            const incomeElem = getElem('total-income');
            const expensesElem = getElem('total-expenses');
            const balanceElem = getElem('net-balance');
            const list = getElem('transaction-list');
            const chartCanvas = getElem('budget-chart');
            const notificationToast = getElem('notification-toast');
            const noTransactionsMessage = getElem('no-transactions-message');

            let transactions = [];
            let chartInstance;

            function init() {
                const storedTransactions = localStorage.getItem('budgetTransactions');
                if (storedTransactions) {
                    transactions = JSON.parse(storedTransactions);
                }
                updateDOM();
                setupChart();
            }

            function updateDOM() {
                list.innerHTML = '';
                let totalIncome = 0;
                let totalExpenses = 0;

                transactions.sort((a, b) => b.id - a.id);

                if (transactions.length === 0) {
                    noTransactionsMessage.classList.remove('hidden');
                } else {
                    noTransactionsMessage.classList.add('hidden');
                }

                transactions.forEach(transaction => {
                    const sign = transaction.type === 'income' ? 1 : -1;
                    const amount = transaction.amount;
                    if (sign === 1) {
                        totalIncome += amount;
                    } else {
                        totalExpenses += amount;
                    }
                    
                    const item = document.createElement('li');
                    item.className = `flex justify-between items-center px-4 py-3 hover:bg-gray-200 transition-colors transaction-list-item`;
                    
                    const amountColor = transaction.type === 'income' ? 'text-green-600' : 'text-red-600';
                    const amountText = transaction.type === 'income' ? `+ ₹${amount.toLocaleString('en-IN')}` : `- ₹${amount.toLocaleString('en-IN')}`;
                    
                    item.innerHTML = `
                        <div class="flex-1 min-w-0">
                            <span class="text-sm text-gray-800 font-medium">${transaction.text}</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="text-sm font-semibold ${amountColor} flex-shrink-0">${amountText}</span>
                            <button class="delete-btn text-gray-400 hover:text-red-500 p-1" data-id="${transaction.id}" aria-label="Delete transaction">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-trash-2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
                            </button>
                        </div>
                    `;
                    list.appendChild(item);
                });

                const netBalance = totalIncome - totalExpenses;
                incomeElem.textContent = `₹${totalIncome.toLocaleString('en-IN')}`;
                expensesElem.textContent = `₹${totalExpenses.toLocaleString('en-IN')}`;
                balanceElem.textContent = `₹${netBalance.toLocaleString('en-IN')}`;
                
                balanceElem.classList.remove('text-blue-800', 'text-green-800', 'text-red-800');
                if (netBalance > 0) {
                    balanceElem.classList.add('text-green-800');
                } else if (netBalance < 0) {
                    balanceElem.classList.add('text-red-800');
                } else {
                    balanceElem.classList.add('text-blue-800');
                }

                updateChartData(totalIncome, totalExpenses);
                saveTransactions();
            }

            function setupChart() {
                const ctx = chartCanvas.getContext('2d');
                if (chartInstance) {
                    chartInstance.destroy();
                }
                chartInstance = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Income', 'Expenses'],
                        datasets: [{
                            data: [1, 1], // Default values to prevent empty chart error
                            backgroundColor: ['#10B981', '#EF4444'],
                            hoverOffset: 8,
                            spacing: 4,
                            borderRadius: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    boxWidth: 12,
                                    font: { size: 12, family: 'Inter' }
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        let label = context.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        if (context.parsed) {
                                            label += `₹${context.parsed.toLocaleString('en-IN')}`;
                                        }
                                        return label;
                                    }
                                }
                            }
                        }
                    }
                });
            }

            function updateChartData(income, expenses) {
                if (chartInstance) {
                    chartInstance.data.datasets[0].data = [income, expenses];
                    chartInstance.update();
                }
            }
            
            function saveTransactions() {
                localStorage.setItem('budgetTransactions', JSON.stringify(transactions));
            }

            function showNotification(message) {
                notificationToast.textContent = message;
                notificationToast.classList.add('opacity-100', 'pointer-events-auto');
                setTimeout(() => {
                    notificationToast.classList.remove('opacity-100', 'pointer-events-auto');
                }, 3000);
            }

            form.addEventListener('submit', (e) => {
                e.preventDefault();
                
                const newTransaction = {
                    id: Date.now(),
                    text: textInput.value.trim(),
                    amount: parseFloat(amountInput.value),
                    type: typeSelect.value,
                };

                if (newTransaction.text === '' || isNaN(newTransaction.amount) || newTransaction.amount <= 0) {
                    showNotification('Please enter a valid description and amount.');
                    return;
                }

                transactions.push(newTransaction);
                updateDOM();

                textInput.value = '';
                amountInput.value = '';
                typeSelect.value = 'expense';
            });

            list.addEventListener('click', (e) => {
                if (e.target.closest('.delete-btn')) {
                    const transactionId = parseInt(e.target.closest('.delete-btn').dataset.id);
                    transactions = transactions.filter(t => t.id !== transactionId);
                    updateDOM();
                    showNotification('Transaction deleted.');
                }
            });

            init();
        });
    </script>
</body>
</html>
