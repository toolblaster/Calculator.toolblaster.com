<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Budget Tracker</title>
    <!-- Use Tailwind CSS for a modern, responsive design -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #374151;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .container {
            max-width: 900px;
            width: 100%;
            margin: 2rem auto;
            padding: 1.5rem;
        }
        .card {
            background-color: #ffffff;
            border-radius: 1.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            padding: 2.5rem;
        }
        .btn-primary {
            background-color: #ef4444; /* Red accent color */
            color: #ffffff;
            font-weight: 600;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .btn-primary:hover {
            background-color: #dc2626; /* Darker red on hover */
            transform: translateY(-2px);
            box-shadow: 0 6px 8px -1px rgba(0, 0, 0, 0.1), 0 3px 5px -1px rgba(0, 0, 0, 0.06);
        }
        .btn-danger {
            background-color: #ef4444;
            color: #ffffff;
            font-weight: 500;
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            transition: background-color 0.2s;
        }
        .btn-danger:hover {
            background-color: #dc2626;
        }
        .summary-item {
            border-radius: 1rem;
            padding: 1.5rem;
            text-align: center;
            font-weight: 700;
        }
        .summary-item.income {
            background-color: #d1fae5;
            color: #065f46;
        }
        .summary-item.expenses {
            background-color: #fee2e2;
            color: #991b1b;
        }
        .summary-item.balance-positive {
            background-color: #d1fae5;
            color: #065f46;
        }
        .summary-item.balance-negative {
            background-color: #fef2f2;
            color: #9f1239;
        }
        .input-field {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            transition: all 0.2s;
        }
        .input-field:focus {
            outline: none;
            border-color: #ef4444; /* Red focus border */
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.2); /* Red focus shadow */
        }
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background-color: #fff;
            padding: 2rem;
            border-radius: 1rem;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        /* New styling for the main header */
        .main-header {
            background-color: #f9fafb;
            padding: 1.5rem 2.5rem;
            border-radius: 1.5rem 1.5rem 0 0;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .card-with-header {
            padding: 0;
        }
        .main-content {
            padding: 2.5rem;
        }
        /* Custom class for the accent line */
        .accent-line {
            width: 100%;
            height: 3px;
            background-color: #ef4444; /* red-500 */
        }
        /* New styles for input with symbol */
        .input-with-symbol {
            display: flex;
            align-items: center;
            width: 100%;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            transition: all 0.2s;
        }
        .input-with-symbol:focus-within {
            border-color: #ef4444;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.2);
        }
        .input-with-symbol .symbol {
            padding-left: 1rem;
            color: #6b7280;
            user-select: none;
        }
        .input-with-symbol input {
            border: none;
            outline: none;
            padding: 0.75rem 1rem;
            background: none;
            flex-grow: 1;
            /* Remove number input spin buttons */
            -moz-appearance: textfield;
            appearance: none;
        }
        .input-with-symbol input::-webkit-outer-spin-button,
        .input-with-symbol input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        .chart-container {
            position: relative;
            height: 300px; /* fixed height for consistent rendering */
            width: 100%;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="card card-with-header">
        <!-- New Visually Scannable Header -->
        <header class="main-header">
            <h1 class="text-3xl font-extrabold text-gray-900">Personal Budget Tracker</h1>
            <!-- Currency Selector -->
            <select id="currencySelector" class="input-field w-auto">
                <option value="$">US Dollar ($)</option>
                <option value="€">Euro (€)</option>
                <option value="₹" selected>Indian Rupee (₹)</option>
                <option value="£">British Pound (£)</option>
                <option value="¥">Japanese Yen (¥)</option>
            </select>
        </header>
        <!-- Thin red accent line added here -->
        <div class="accent-line"></div>

        <div class="main-content">
            <!-- Income and Summary Section -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-end mb-8">
                <div class="space-y-4">
                    <div class="text-lg font-semibold text-gray-700">Set Your Monthly Income</div>
                    <!-- New input with currency symbol -->
                    <div class="flex items-center space-x-4">
                        <div class="input-with-symbol flex-1">
                            <span id="incomeInputSymbol" class="symbol">₹</span>
                            <input type="text" id="incomeInput" placeholder="5000" inputmode="decimal">
                        </div>
                        <button id="setIncomeBtn" class="btn-primary">Set Income</button>
                    </div>
                </div>
                <div class="summary-item income">
                    <p class="text-sm font-normal opacity-90">Total Income</p>
                    <p id="totalIncome" class="text-3xl mt-1 font-extrabold">
                        <span id="incomeSymbol">₹</span>0.00
                    </p>
                </div>
            </div>

            <!-- Expense Form Section -->
            <div class="border-t border-gray-200 pt-8 mt-4">
                <h2 class="text-2xl font-bold mb-6 text-gray-900">Add a New Expense</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                    <input type="text" id="categoryInput" class="input-field" placeholder="Category (e.g., Groceries)">
                    <input type="text" id="descriptionInput" class="input-field" placeholder="Description (e.g., Weekly shopping)">
                    <!-- New input with currency symbol -->
                    <div class="input-with-symbol">
                        <span id="amountInputSymbol" class="symbol">₹</span>
                        <input type="text" id="amountInput" placeholder="150" inputmode="decimal">
                    </div>
                </div>
                <button id="addExpenseBtn" class="btn-primary w-full">Add Expense</button>
            </div>

            <!-- Remaining Balance and Expense List -->
            <div class="mt-8 grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="md:col-span-1">
                    <div class="summary-item expenses mb-4">
                        <p class="text-sm font-normal opacity-90">Total Expenses</p>
                        <p id="totalExpenses" class="text-3xl mt-1 font-extrabold">
                            <span id="expensesSymbol">₹</span>0.00
                        </p>
                    </div>
                    <div class="summary-item" id="balanceBox">
                        <p class="text-sm font-normal opacity-90">Remaining Balance</p>
                        <p id="remainingBalance" class="text-3xl mt-1 font-extrabold">
                            <span id="balanceSymbol">₹</span>0.00
                        </p>
                    </div>
                </div>
                <div class="md:col-span-2">
                    <h2 class="text-2xl font-bold mb-4 text-gray-900">Your Expenses</h2>
                    <div id="expensesList" class="space-y-4">
                        <!-- Expenses will be dynamically added here -->
                        <div class="p-6 text-center text-gray-500 bg-gray-100 rounded-lg">No expenses added yet.</div>
                    </div>
                </div>
            </div>
            
            <!-- New Data Visualization Section -->
            <div class="mt-10 border-t border-gray-200 pt-8">
                <h2 class="text-2xl font-bold mb-6 text-gray-900">Spending Breakdown</h2>
                <div class="chart-container">
                    <canvas id="spendingChart"></canvas>
                </div>
            </div>

        </div>
    </div>
</div>

<!-- Custom Modal/Message Box -->
<div id="messageModal" class="modal">
    <div class="modal-content">
        <p id="modalMessage" class="text-lg font-semibold mb-4"></p>
        <button id="closeModalBtn" class="btn-primary">OK</button>
    </div>
</div>

<script>
    // JavaScript for the budget tracker functionality
    document.addEventListener('DOMContentLoaded', () => {

        // Get references to all necessary HTML elements
        const incomeInput = document.getElementById('incomeInput');
        const setIncomeBtn = document.getElementById('setIncomeBtn');
        const categoryInput = document.getElementById('categoryInput');
        const descriptionInput = document.getElementById('descriptionInput');
        const amountInput = document.getElementById('amountInput');
        const addExpenseBtn = document.getElementById('addExpenseBtn');
        const totalIncomeEl = document.getElementById('totalIncome');
        const totalExpensesEl = document.getElementById('totalExpenses');
        const remainingBalanceEl = document.getElementById('remainingBalance');
        const balanceBox = document.getElementById('balanceBox');
        const expensesListEl = document.getElementById('expensesList');
        const currencySelector = document.getElementById('currencySelector');

        // References to the currency symbols
        const incomeSymbolEl = document.getElementById('incomeSymbol');
        const expensesSymbolEl = document.getElementById('expensesSymbol');
        const balanceSymbolEl = document.getElementById('balanceSymbol');
        const incomeInputSymbol = document.getElementById('incomeInputSymbol');
        const amountInputSymbol = document.getElementById('amountInputSymbol');

        // Modal elements
        const messageModal = document.getElementById('messageModal');
        const modalMessage = document.getElementById('modalMessage');
        const closeModalBtn = document.getElementById('closeModalBtn');
        
        // Chart.js setup
        const chartCtx = document.getElementById('spendingChart').getContext('2d');
        let spendingChart = new Chart(chartCtx, {
            type: 'pie',
            data: {
                labels: [],
                datasets: [{
                    data: [],
                    backgroundColor: [],
                    hoverOffset: 4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                let label = context.label || '';
                                if (label) {
                                    label += ': ';
                                }
                                if (context.parsed !== null) {
                                    label += context.parsed.toFixed(2) + '%';
                                }
                                return label;
                            }
                        }
                    }
                }
            }
        });

        // Initialize state variables for the budget data
        let monthlyIncome = 0;
        let expenses = [];
        let currentCurrency = '₹';

        // Function to show the custom message box
        function showMessage(message) {
            modalMessage.textContent = message;
            messageModal.style.display = 'flex';
        }

        // Event listener to hide the modal
        closeModalBtn.addEventListener('click', () => {
            messageModal.style.display = 'none';
        });

        // Function to generate a consistent color for a given category
        function getCategoryColor(category) {
            const colors = {
                'Groceries': '#3b82f6',
                'Utilities': '#10b981',
                'Rent': '#f59e0b',
                'Transportation': '#ef4444',
                'Dining Out': '#8b5cf6',
                'Entertainment': '#ec4899',
                'Shopping': '#6b7280',
                'Health': '#0ea5e9',
                'Other': '#d1d5db'
            };
            return colors[category] || '#d1d5db';
        }

        // Function to update the pie chart
        function updateChart() {
            // Group expenses by category
            const categoryTotals = expenses.reduce((acc, expense) => {
                const category = expense.category || 'Other';
                acc[category] = (acc[category] || 0) + Number(expense.amount);
                return acc;
            }, {});

            const categories = Object.keys(categoryTotals);
            const amounts = categories.map(cat => categoryTotals[cat]);

            // Calculate total expenses for percentage calculation
            const totalExpenses = amounts.reduce((sum, amount) => sum + amount, 0);

            // Calculate percentages and update chart data
            const percentages = amounts.map(amount => (amount / totalExpenses) * 100);

            spendingChart.data.labels = categories;
            spendingChart.data.datasets[0].data = percentages;
            spendingChart.data.datasets[0].backgroundColor = categories.map(getCategoryColor);
            spendingChart.update();
        }

        // Function to save data to local storage
        function saveData() {
            localStorage.setItem('monthlyIncome', JSON.stringify(monthlyIncome));
            localStorage.setItem('expenses', JSON.stringify(expenses));
            localStorage.setItem('currency', currentCurrency);
        }

        // Function to load data from local storage
        function loadData() {
            const storedIncome = localStorage.getItem('monthlyIncome');
            const storedExpenses = localStorage.getItem('expenses');
            const storedCurrency = localStorage.getItem('currency');

            if (storedIncome) {
                monthlyIncome = JSON.parse(storedIncome);
            }
            if (storedExpenses) {
                expenses = JSON.parse(storedExpenses);
            }
            if (storedCurrency) {
                currentCurrency = storedCurrency;
                currencySelector.value = currentCurrency;
            }
            updateUI();
        }
        
        // Function to extract a number from a string with a currency symbol
        function parseCurrencyInput(value) {
            const sanitizedValue = value.replace(/[^0-9.]/g, '');
            return parseFloat(sanitizedValue);
        }

        // Function to render expenses in the UI
        function renderExpenses() {
            expensesListEl.innerHTML = '';
            if (expenses.length === 0) {
                expensesListEl.innerHTML = '<div class="p-6 text-center text-gray-500 bg-gray-100 rounded-lg">No expenses added yet.</div>';
            }
            expenses.forEach((expense, index) => {
                const expenseItem = document.createElement('div');
                expenseItem.className = 'flex items-center justify-between p-4 bg-gray-50 rounded-lg shadow-sm';
                expenseItem.innerHTML = `
                    <div class="flex-1 min-w-0 pr-4">
                        <p class="font-semibold text-gray-800">${expense.category}</p>
                        <p class="text-sm text-gray-500 truncate">${expense.description}</p>
                    </div>
                    <div class="flex items-center space-x-2">
                        <p class="text-lg font-bold text-gray-900">${currentCurrency}${Number(expense.amount).toFixed(2)}</p>
                        <button class="btn-danger delete-btn" data-index="${index}">Delete</button>
                    </div>
                `;
                expensesListEl.appendChild(expenseItem);
            });
        }

        // Function to update all summary values and the UI
        function updateUI() {
            // Update currency symbols
            incomeSymbolEl.textContent = currentCurrency;
            expensesSymbolEl.textContent = currentCurrency;
            balanceSymbolEl.textContent = currentCurrency;
            incomeInputSymbol.textContent = currentCurrency;
            amountInputSymbol.textContent = currentCurrency;

            // Update the income display
            totalIncomeEl.textContent = `${currentCurrency}${monthlyIncome.toFixed(2)}`;
            incomeInput.value = monthlyIncome > 0 ? monthlyIncome : '';
            amountInput.value = '';

            // Calculate total expenses and remaining balance
            const totalExpenses = expenses.reduce((sum, expense) => sum + Number(expense.amount), 0);
            const remainingBalance = monthlyIncome - totalExpenses;

            // Update the expense and balance displays
            totalExpensesEl.textContent = `${currentCurrency}${totalExpenses.toFixed(2)}`;
            remainingBalanceEl.textContent = `${currentCurrency}${remainingBalance.toFixed(2)}`;

            // Change balance box color based on the balance
            balanceBox.classList.remove('balance-positive', 'balance-negative');
            if (remainingBalance >= 0) {
                balanceBox.classList.add('balance-positive');
            } else {
                balanceBox.classList.add('balance-negative');
            }

            // Re-render the list of expenses and update the chart
            renderExpenses();
            updateChart();
            saveData();
        }

        // Event listener for the currency selector
        currencySelector.addEventListener('change', (event) => {
            currentCurrency = event.target.value;
            updateUI();
        });

        // Event listener to set the monthly income
        setIncomeBtn.addEventListener('click', () => {
            const income = parseCurrencyInput(incomeInput.value);
            if (!isNaN(income) && income >= 0) {
                monthlyIncome = income;
                updateUI();
            } else {
                showMessage("Please enter a valid positive number for your income.");
            }
        });

        // Event listener to add a new expense
        addExpenseBtn.addEventListener('click', () => {
            const category = categoryInput.value.trim();
            const description = descriptionInput.value.trim();
            const amount = parseCurrencyInput(amountInput.value);

            if (category && description && !isNaN(amount) && amount > 0) {
                expenses.push({ category, description, amount });
                // Clear the input fields after adding
                categoryInput.value = '';
                descriptionInput.value = '';
                amountInput.value = '';
                updateUI();
            } else {
                showMessage("Please fill out all fields with valid data.");
            }
        });

        // Event listener to handle the deletion of an expense using event delegation
        expensesListEl.addEventListener('click', (event) => {
            if (event.target.classList.contains('delete-btn')) {
                const index = event.target.dataset.index;
                expenses.splice(index, 1);
                updateUI();
            }
        });
        
        // Add event listeners to income and amount inputs to handle formatting
        incomeInput.addEventListener('input', (event) => {
            const value = event.target.value.replace(/[^0-9.]/g, '');
            event.target.value = value;
        });
        amountInput.addEventListener('input', (event) => {
            const value = event.target.value.replace(/[^0-9.]/g, '');
            event.target.value = value;
        });

        // Initial load of data when the page is first loaded
        loadData();
    });
</script>

</body>
</html>
